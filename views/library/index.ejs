<!-- views/library/index.ejs -->
<div class="library-header">
    <div class="library-header-top">
        <% if (user) { %>
            <a href="/dashboard" class="btn btn-outline btn-small">
                <i class="fas fa-arrow-left"></i> Вернуться в кабинет
            </a>
        <% } %>
        
        <div class="library-header-content">
            <h1>Публичная библиотека</h1>
            <p>Изучайте готовые колоды карточек от других пользователей</p>
        </div>
    </div>
    
    <div class="search-box">
        <input type="text" placeholder="Поиск по названию, описанию или тегам..." 
               id="searchInput" class="form-control">
        <button class="btn btn-primary" onclick="searchDecks()">
            <i class="fas fa-search"></i> Найти
        </button>
    </div>
</div>

<div class="library-filters">
    <div class="filter-tags">
        <span class="filter-tag active" onclick="showAllDecks()">Все</span>
        <span class="filter-tag" onclick="filterPopular()">Популярные</span>
        <span class="filter-tag" onclick="filterNew()">Новые</span>
    </div>
</div>

<div class="decks-grid" id="decksGrid">
    <% if (decks.length === 0) { %>
        <div class="empty-state">
            <i class="fas fa-book-open fa-3x"></i>
            <h3>В библиотеке пока нет колод</h3>
            <p>Будьте первым, кто создаст публичную колоду!</p>
        </div>
    <% } else { %>
        <% decks.forEach(deck => { %>
            <div class="card deck-card library-deck">
                <div class="deck-header">
                    <h3><%= deck.name %></h3>
                    <span class="deck-badge">
                        <i class="fas fa-users"></i> Публичная
                    </span>
                </div>
                
                <p class="deck-description"><%= deck.description || 'Без описания' %></p>
                
                <div class="deck-meta">
                    <span class="deck-author">
                        <i class="fas fa-user"></i> <%= deck.User.username %>
                    </span>
                    
                    <span class="deck-date">
                        <i class="fas fa-calendar"></i> 
                        <%= new Date(deck.createdAt).toLocaleDateString() %>
                    </span>
                </div>
                
                <div class="deck-actions">
                    <a href="/decks/<%= deck.id %>" class="btn btn-primary btn-small">
                        <i class="fas fa-eye"></i> Просмотр
                    </a>
                    <% if (user && user.role !== 'admin') { %>
                        <button class="btn btn-primary btn-small import-deck-btn" 
                            data-deck-id="<%= deck.id %>">
                            <i class="fas fa-download"></i> Импорт
                        </button>
                    <% } else if (!user) { %>
                        <a href="/login" class="btn btn-primary btn-small">
                            <i class="fas fa-sign-in-alt"></i> Войти для импорта
                        </a>
                    <% } %>
                </div>
            </div>
        <% }); %>
    <% } %>
</div>

<style>
.library-header {
    text-align: center;
    margin-bottom: 40px;
    background: linear-gradient(135deg, #1976D2 0%, #2196F3 100%);
    color: white;
    padding: 50px 30px;
    border-radius: 16px;
    box-shadow: 0 15px 35px rgba(33, 150, 243, 0.2);
    position: relative;
    overflow: hidden;
}

.library-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url("data:image/svg+xml,%3Csvg width='200' height='200' viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M20 40c24.85 0 45-20.15 45-45S44.85-50 20-50-25-29.85-25-5s20.15 45 45 45zm130 65c24.85 0 45-20.15 45-45S174.85-15 150-15s-45 20.15-45 45 20.15 45 45 45zM-10 165c24.85 0 45-20.15 45-45S14.85 75-10 75s-45 20.15-45 45 20.15 45 45 45z' fill='%2364b5f6' fill-opacity='0.1' fill-rule='evenodd'/%3E%3C/svg%3E");
    opacity: 0.2;
}

.library-header-top {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 30px;
    flex-wrap: wrap;
    gap: 20px;
}

.library-header-content {
    flex: 1;
    text-align: center;
}

.library-header-top .btn-small {
    background: rgba(255, 255, 255, 0.15);
    border: 2px solid rgba(255, 255, 255, 0.3);
    color: white;
    padding: 10px 20px;
    border-radius: 8px;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
    position: relative;
    z-index: 1;
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.library-header-top .btn-small:hover {
    background: white;
    color: #1976D2;
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
}

.library-header h1 {
    font-size: 2.8rem;
    margin-bottom: 15px;
    font-weight: 700;
    position: relative;
    z-index: 1;
}

.library-header p {
    font-size: 1.3rem;
    opacity: 0.95;
    max-width: 600px;
    margin: 0 auto 30px;
    line-height: 1.6;
    position: relative;
    z-index: 1;
}

.search-box {
    max-width: 600px;
    margin: 0 auto;
    display: flex;
    gap: 15px;
    position: relative;
    z-index: 1;
}

.search-box .form-control {
    flex: 1;
    padding: 18px 25px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 12px;
    font-size: 16px;
    background: rgba(255, 255, 255, 0.1);
    color: white;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
}

.search-box .form-control::placeholder {
    color: rgba(255, 255, 255, 0.7);
}

.search-box .form-control:focus {
    background: rgba(255, 255, 255, 0.15);
    border-color: white;
    box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.1);
    outline: none;
}

.search-box .btn-primary {
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.3);
    color: white;
    padding: 18px 35px;
    border-radius: 12px;
    font-weight: 600;
    transition: all 0.3s ease;
}

.search-box .btn-primary:hover {
    background: white;
    color: #1976D2;
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
}

.library-filters {
    margin-bottom: 40px;
    padding: 30px;
    background: white;
    border-radius: 16px;
    box-shadow: 0 8px 25px rgba(33, 150, 243, 0.1);
    border: 2px solid #e3f2fd;
}

.filter-tags {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
    justify-content: center;
}

.filter-tag {
    padding: 12px 24px;
    background: #e3f2fd;
    border: 2px solid #bbdefb;
    color: #1976D2;
    border-radius: 25px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: 600;
    font-size: 15px;
}

.filter-tag:hover {
    background: #bbdefb;
    border-color: #2196F3;
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(33, 150, 243, 0.15);
}

.filter-tag.active {
    background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
    color: white;
    border-color: #1976D2;
}

.decks-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 25px;
}

.library-deck {
    display: flex;
    flex-direction: column;
    background: white;
    border-radius: 16px;
    padding: 25px;
    box-shadow: 0 8px 25px rgba(33, 150, 243, 0.1);
    border: 2px solid #e3f2fd;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.library-deck::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #2196F3 0%, #64b5f6 100%);
}

.library-deck:hover {
    transform: translateY(-8px);
    box-shadow: 0 15px 35px rgba(33, 150, 243, 0.15);
    border-color: #bbdefb;
}

.deck-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 15px;
    gap: 10px;
}

.deck-header h3 {
    color: #1976D2;
    font-size: 1.4rem;
    font-weight: 600;
    margin: 0;
    flex: 1;
}

.deck-badge {
    background: linear-gradient(135deg, #4CAF50 0%, #388E3C 100%);
    color: white;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: bold;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    white-space: nowrap;
    border: 2px solid #81c784;
}

.deck-description {
    color: #546e7a;
    margin-bottom: 20px;
    flex: 1;
    line-height: 1.6;
    min-height: 60px;
}

.deck-meta {
    display: flex;
    justify-content: space-between;
    color: #607d8b;
    font-size: 14px;
    margin-bottom: 20px;
    padding-bottom: 20px;
    border-bottom: 2px solid #e3f2fd;
    flex-wrap: wrap;
    gap: 15px;
}

.deck-meta span {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-weight: 500;
}

.deck-meta i {
    color: #2196F3;
    font-size: 14px;
}

.deck-sessions {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-weight: 500;
    color: #607d8b;
    font-size: 14px;
}

.deck-sessions i {
    color: #2196F3;
    font-size: 14px;
}

.deck-actions {
    display: flex;
    gap: 10px;
    margin-top: auto;
}

.deck-actions .btn-small {
    padding: 10px 20px;
    font-size: 14px;
    font-weight: 600;
    border-radius: 8px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    text-decoration: none;
    transition: all 0.3s ease;
}

.deck-actions .btn-primary {
    background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
    color: white;
    border: none;
}

.deck-actions .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(33, 150, 243, 0.3);
}

.deck-actions .btn-outline {
    background: white;
    border: 2px solid #bbdefb;
    color: #1976D2;
}

.deck-actions .btn-outline:hover {
    background: #e3f2fd;
    border-color: #2196F3;
    transform: translateY(-2px);
}

.empty-state {
    grid-column: 1 / -1;
    text-align: center;
    padding: 80px 40px;
    color: #546e7a;
    background: #f8fbff;
    border-radius: 16px;
    border: 2px dashed #bbdefb;
}

.empty-state i {
    color: #bbdefb;
    margin-bottom: 25px;
    font-size: 60px;
}

.empty-state h3 {
    margin-bottom: 15px;
    color: #2c3e50;
    font-size: 1.8rem;
    font-weight: 600;
}

.empty-state p {
    margin-bottom: 25px;
    font-size: 1.1rem;
    max-width: 400px;
    margin-left: auto;
    margin-right: auto;
    line-height: 1.6;
}

@media (max-width: 768px) {
    .library-header {
        padding: 40px 20px;
    }
    
    .library-header h1 {
        font-size: 2.2rem;
    }
    
    .library-header p {
        font-size: 1.1rem;
    }
    
    .library-header-top {
        flex-direction: column;
        align-items: center;
        text-align: center;
    }
    
    .library-header-top .btn-small {
        align-self: center;
    }
    
    .search-box {
        flex-direction: column;
    }
    
    .search-box .btn-primary {
        width: 100%;
        border-radius: 12px;
    }
    
    .decks-grid {
        grid-template-columns: 1fr;
    }
    
    .library-filters {
        padding: 25px 20px;
    }
    
    .filter-tags {
        justify-content: flex-start;
    }
    
    .filter-tag {
        padding: 10px 20px;
        font-size: 14px;
    }
    
    .deck-meta {
        gap: 10px;
    }
    
    .deck-sessions {
        width: 100%;
        justify-content: center;
        margin-top: 5px;
    }
}
</style>

<script>
let allDecks = [];
let currentFilter = 'all';

// Функция для получения всех колод при загрузке
async function loadAllDecks() {
    try {
        console.log('Загрузка всех колод...');
        const response = await fetch('/api/library/decks');
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        console.log('Ответ от сервера:', data);
        
        if (data.success) {
            allDecks = data.decks;
            console.log('Загружено колод:', allDecks.length);
        } else {
            console.error('Ошибка загрузки колод:', data.message);
            // Используем существующие данные из EJS
            allDecks = [
                <% decks.forEach(deck => { %>
                    {
                        id: <%= deck.id %>,
                        name: "<%= deck.name.replace(/"/g, '\\"') %>",
                        description: "<%= (deck.description || '').replace(/"/g, '\\"') %>",
                        createdAt: "<%= deck.createdAt %>",
                        username: "<%= deck.User.username %>",
                        sessionsCount: 0
                    },
                <% }); %>
            ];
        }
    } catch (error) {
        console.error('Ошибка при загрузке колод:', error);
        
        allDecks = [
            <% decks.forEach(deck => { %>
                {
                    id: <%= deck.id %>,
                    name: "<%= deck.name.replace(/"/g, '\\"') %>",
                    description: "<%= (deck.description || '').replace(/"/g, '\\"') %>",
                    createdAt: "<%= deck.createdAt %>",
                    username: "<%= deck.User.username %>",
                    sessionsCount: 0
                },
            <% }); %>
        ];
    }
}

// Показать все колоды
function showAllDecks() {
    console.log('showAllDecks вызвана');
    updateActiveFilter('all');
    currentFilter = 'all';
    
    // Восстанавливаем исходный порядок
    const initialDecks = [
        <% decks.forEach(deck => { %>
            {
                id: <%= deck.id %>,
                name: "<%= deck.name.replace(/"/g, '\\"') %>",
                description: "<%= (deck.description || '').replace(/"/g, '\\"') %>",
                createdAt: "<%= deck.createdAt %>",
                username: "<%= deck.User.username %>",
                sessionsCount: 0
            },
        <% }); %>
    ];
    
    renderDecks(initialDecks);
}

// Фильтр "Новые" (по дате создания, новые сверху)
async function filterNew() {
    console.log('filterNew вызвана');
    updateActiveFilter('new');
    
    try {
        console.log('Запрашиваем новые колоды...');
        const response = await fetch('/api/library/decks');
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        console.log('Получены данные для новых колод:', data);
        
        if (data.success && data.decks && data.decks.length > 0) {
           
            const sortedDecks = data.decks.sort((a, b) => {
                return new Date(b.createdAt) - new Date(a.createdAt);
            });
            
            console.log('Отсортированы новые колоды:', sortedDecks.length);
            renderDecks(sortedDecks);
        } else {
            console.log('Нет данных, используем allDecks');
            const sortedDecks = [...allDecks].sort((a, b) => {
                return new Date(b.createdAt) - new Date(a.createdAt);
            });
            renderDecks(sortedDecks);
        }
    } catch (error) {
        console.error('Ошибка при загрузке новых колод:', error);
        const sortedDecks = [...allDecks].sort((a, b) => {
            return new Date(b.createdAt) - new Date(a.createdAt);
        });
        renderDecks(sortedDecks);
    }
}

// Фильтр "Популярные" (по количеству сессий)
async function filterPopular() {
    console.log('filterPopular вызвана');
    updateActiveFilter('popular');
    
    try {
        console.log('Запрашиваем популярные колоды...');
        const response = await fetch('/api/library/decks-with-sessions');
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        console.log('Получены данные для популярных колод:', data);
        
        if (data.success && data.decks && data.decks.length > 0) {
           
            const popularDecks = data.decks.sort((a, b) => {
                return (b.sessionsCount || 0) - (a.sessionsCount || 0);
            });
            
            console.log('Отсортированы популярные колоды:', popularDecks.length);
            renderDecks(popularDecks);
        } else {
            console.log('Нет данных, используем fallback');
            
            const sortedDecks = [...allDecks].sort((a, b) => b.id - a.id);
            renderDecks(sortedDecks);
        }
    } catch (error) {
        console.error('Ошибка при загрузке популярных колод:', error);
        
        const sortedDecks = [...allDecks].sort((a, b) => b.id - a.id);
        renderDecks(sortedDecks);
    }
}

// Обновление активной кнопки фильтра 
function updateActiveFilter(clickedFilter) {
    console.log('updateActiveFilter для:', clickedFilter);
    
   
    document.querySelectorAll('.filter-tag').forEach(tag => {
        tag.classList.remove('active');
    });
    
    
    document.querySelectorAll('.filter-tag').forEach(tag => {
        const buttonText = tag.textContent.trim().toLowerCase();
        
        if (clickedFilter === 'all' && (buttonText === 'все' || buttonText === 'all')) {
            tag.classList.add('active');
        } else if (clickedFilter === 'popular' && (buttonText === 'популярные' || buttonText === 'popular')) {
            tag.classList.add('active');
        } else if (clickedFilter === 'new' && (buttonText === 'новые' || buttonText === 'new')) {
            tag.classList.add('active');
        }
    });
}

// Рендеринг колод в сетке
function renderDecks(decksArray) {
    console.log('renderDecks вызвана, колод:', decksArray?.length || 0);
    const decksGrid = document.getElementById('decksGrid');
    
    if (!decksGrid) {
        console.error('Элемент decksGrid не найден!');
        return;
    }
    
    if (!decksArray || decksArray.length === 0) {
        decksGrid.innerHTML = `
            <div class="empty-state">
                <i class="fas fa-book-open fa-3x"></i>
                <h3>В библиотеке пока нет колод</h3>
                <p>Будьте первым, кто создаст публичную колоду!</p>
            </div>
        `;
        return;
    }
    
    let html = '';
    
    decksArray.forEach(deck => {
        html += `
            <div class="card deck-card library-deck">
                <div class="deck-header">
                    <h3>${deck.name}</h3>
                    <span class="deck-badge">
                        <i class="fas fa-users"></i> Публичная
                    </span>
                </div>
                
                <p class="deck-description">${deck.description || 'Без описания'}</p>
                
                <div class="deck-meta">
                    <span class="deck-author">
                        <i class="fas fa-user"></i> ${deck.username}
                    </span>
                    
                    <span class="deck-date">
                        <i class="fas fa-calendar"></i> 
                        ${new Date(deck.createdAt).toLocaleDateString()}
                    </span>
                    
                    ${deck.sessionsCount !== undefined && deck.sessionsCount > 0 ? `
                    <span class="deck-sessions">
                        <i class="fas fa-graduation-cap"></i> 
                        ${deck.sessionsCount} сессий
                    </span>
                    ` : ''}
                </div>
                
                <div class="deck-actions">
                    <a href="/decks/${deck.id}" class="btn btn-primary btn-small">
                        <i class="fas fa-eye"></i> Просмотр
                    </a>
                    <% if (user && user.role !== 'admin') { %>
                        <button class="btn btn-primary btn-small import-deck-btn" 
                            data-deck-id="${deck.id}">
                            <i class="fas fa-download"></i> Импорт
                        </button>
                    <% } else if (!user) { %>
                        <a href="/login" class="btn btn-primary btn-small">
                            <i class="fas fa-sign-in-alt"></i> Войти для импорта
                        </a>
                    <% } %>
                </div>
            </div>
        `;
    });
    
    decksGrid.innerHTML = html;
    
    // Назначаем обработчики для кнопок импорта
    document.querySelectorAll('.import-deck-btn').forEach(button => {
        button.addEventListener('click', function() {
            const deckId = this.getAttribute('data-deck-id');
            importDeck.call(this, deckId);
        });
    });
}

// Функция для импорта колоды
async function importDeck(deckId) {
    if (confirm('Импортировать эту колоду в вашу библиотеку?')) {
        try {
            const button = event.currentTarget || event.target;
            const originalContent = button.innerHTML;
            const originalColor = button.style.backgroundColor;
            
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Импорт...';
            button.style.backgroundColor = '#FF9800';
            button.disabled = true;
            
            const response = await fetch(`/api/decks/${deckId}/import`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                credentials: 'same-origin'
            });
            
            const data = await response.json();
            
            if (data.success) {
                
                button.innerHTML = '<i class="fas fa-check"></i> Импортировано';
                button.style.backgroundColor = '#4CAF50';
                
                
                showNotification('Колода успешно импортирована в вашу библиотеку!', 'success');
                
              
                setTimeout(() => {
                    if (confirm('Колода успешно импортирована! Хотите перейти в свой кабинет?')) {
                        window.location.href = '/dashboard';
                    }
                }, 2000);
                
            } else {
                
                button.innerHTML = '<i class="fas fa-times"></i> Ошибка';
                button.style.backgroundColor = '#f44336';
                
                showNotification('Ошибка при импорте колоды: ' + (data.message || 'Неизвестная ошибка'), 'error');
                
                
                setTimeout(() => {
                    button.innerHTML = originalContent;
                    button.style.backgroundColor = originalColor;
                    button.disabled = false;
                }, 3000);
            }
            
        } catch (error) {
            console.error('Ошибка при импорте колоды:', error);
            alert('Ошибка при импорте колоды. Пожалуйста, попробуйте позже.');
            
           
            const button = event.currentTarget || event.target;
            button.innerHTML = '<i class="fas fa-download"></i> Импорт';
            button.disabled = false;
        }
    }
}

// Функция для показа уведомлений
function showNotification(message, type = 'info') {
   
    const notification = document.createElement('div');
    notification.className = `library-notification notification-${type}`;
    notification.innerHTML = `
        <div class="notification-content">
            <i class="fas fa-${getNotificationIcon(type)}"></i>
            <span>${message}</span>
        </div>
        <button class="close-notification">×</button>
    `;
    
    document.body.appendChild(notification);
    
    
    setTimeout(() => {
        notification.classList.add('show');
    }, 10);
    
    
    notification.querySelector('.close-notification').addEventListener('click', () => {
        notification.classList.remove('show');
        setTimeout(() => {
            if (notification.parentNode) {
                notification.remove();
            }
        }, 300);
    });
    
    
    setTimeout(() => {
        if (notification.parentNode && notification.classList.contains('show')) {
            notification.classList.remove('show');
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 300);
        }
    }, 5000);
}

// Получить иконку для уведомления
function getNotificationIcon(type) {
    const icons = {
        'info': 'info-circle',
        'success': 'check-circle',
        'error': 'exclamation-circle',
        'warning': 'exclamation-triangle'
    };
    return icons[type] || 'info-circle';
}

// Поиск колод
function searchDecks() {
    const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    const decks = document.querySelectorAll('.library-deck');
    
    decks.forEach(deck => {
        const title = deck.querySelector('h3').textContent.toLowerCase();
        const description = deck.querySelector('.deck-description').textContent.toLowerCase();
        
        if (title.includes(searchTerm) || description.includes(searchTerm)) {
            deck.style.display = 'block';
        } else {
            deck.style.display = 'none';
        }
    });
}

// Инициализация при загрузке страницы
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM загружен, инициализация библиотеки...');
    
   
    loadAllDecks();
    
   
    const filterButtons = document.querySelectorAll('.filter-tag');
    console.log('Найдено кнопок фильтрации:', filterButtons.length);
    
    filterButtons.forEach(button => {
        
        const buttonText = button.textContent.trim().toLowerCase();
        console.log('Настраиваем кнопку:', buttonText);
        
        
        button.removeAttribute('onclick');
        
        
        button.addEventListener('click', function(e) {
            console.log('Клик по кнопке:', buttonText);
            
            if (buttonText.includes('все') || buttonText === 'все') {
                showAllDecks();
            } else if (buttonText.includes('новые') || buttonText === 'новые') {
                filterNew();
            } else if (buttonText.includes('популярные') || buttonText === 'популярные') {
                filterPopular();
            }
        });
    });
    
    
    document.querySelectorAll('.import-deck-btn').forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault();
            const deckId = this.getAttribute('data-deck-id');
            importDeck.call(this, deckId);
        });
    });
    
    
    const searchInput = document.getElementById('searchInput');
    if (searchInput) {
        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchDecks();
            }
        });
    }
});


const notificationStyles = document.createElement('style');
notificationStyles.textContent = `
    .library-notification {
        position: fixed;
        top: 20px;
        right: 20px;
        background: white;
        border-radius: 12px;
        padding: 20px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        min-width: 300px;
        max-width: 400px;
        z-index: 10000;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        border-left: 4px solid;
        transform: translateX(120%);
        transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        border: 2px solid;
    }
    
    .library-notification.show {
        transform: translateX(0);
    }
    
    .notification-content {
        display: flex;
        align-items: center;
        gap: 12px;
        flex: 1;
    }
    
    .library-notification i {
        font-size: 20px;
    }
    
    .notification-info {
        border-left-color: #2196F3;
        border-color: #e3f2fd;
        background: #e3f2fd;
        color: #1976D2;
    }
    
    .notification-info i {
        color: #2196F3;
    }
    
    .notification-success {
        border-left-color: #4CAF50;
        border-color: #e8f5e9;
        background: #e8f5e9;
        color: #388E3C;
    }
    
    .notification-success i {
        color: #4CAF50;
    }
    
    .notification-error {
        border-left-color: #f44336;
        border-color: #ffebee;
        background: #ffebee;
        color: #c62828;
    }
    
    .notification-error i {
        color: #f44336;
    }
    
    .notification-warning {
        border-left-color: #FF9800;
        border-color: #fff3e0;
        background: #fff3e0;
        color: #f57c00;
    }
    
    .notification-warning i {
        color: #FF9800;
    }
    
    .close-notification {
        background: rgba(0, 0, 0, 0.1);
        border: none;
        color: inherit;
        font-size: 24px;
        cursor: pointer;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-left: 15px;
        transition: background 0.3s;
        opacity: 0.7;
    }
    
    .close-notification:hover {
        background: rgba(0, 0, 0, 0.2);
        opacity: 1;
    }
    
    @keyframes slideInRight {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }
    
    @media (max-width: 768px) {
        .library-notification {
            left: 20px;
            right: 20px;
            max-width: none;
        }
    }
`;
document.head.appendChild(notificationStyles);
</script>